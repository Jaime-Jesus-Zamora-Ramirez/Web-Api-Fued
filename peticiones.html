<!DOCTYPE html>
<html>
<head>
    <title>Dente &mdash; Colorlib Website Template</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="./css/peticiones.css"> <!------------Archvio css---------------------->
    <style>
        .delete-button {
            background-color: #ff4b4b;
            color: #fff;
            border: none;
            border-radius: 3px;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h2>PETICIONES</h2>
<!------------------------------------------Mostrara las diferentes peticiones----------------------------->
    <div id="taskTable"></div>
    <button class="button" onclick="performRequest('GET')">Mostrar Dentistas</button>
    <a href="./peticionpost.html"><button class="button" >Registrar Dentista</button></a>
    <a href="./peticionput.html"><button class="button">Editar Dentista</button></a>
    
    <script>
//---------------------------------------------Peticion GET---------------------------//
        function performRequest(requestName) {
            if (requestName === 'GET') {
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            try {
                                var response = JSON.parse(xhr.responseText);
                                displayTasks(response); // Llamar a la función para mostrar las tareas
                            } catch (error) {
                                console.error("Error al analizar la respuesta JSON:", error);
                            }
                        } else {
                            console.error("Error en la solicitud HTTP:", xhr.status, xhr.statusText);
                        }
                    }
                };
                xhr.open('GET', './api/api.php', true); // Cambiar la ruta del archivo api.php
                xhr.send();
            }
        }
//---------------------------------------------Fin---------------------------//

//---------------------------------------------Mostrar en tabla---------------------------//
        function displayTasks(tasks) {
            var taskTableDiv = document.getElementById('taskTable');
            var taskTableHTML = '<h3></h3><table>';
            
            // Encabezados de la tabla
            taskTableHTML += '<tr><th>ID</th><th>Titulo</th><th>Descripcion</th><th>imagen_url</th><th>Eliminar</th></tr>';
            
            tasks.forEach(function(task) {
                taskTableHTML += `
                    <tr>
                        <td>${task.id_dentista}</td>
                        <td>${task.titulo}</td>
                        <td>${task.descripcion}</td>
                        <td>${task.imagen_url}</td>
                        <td><button class="delete-button" onclick="deleteTask(${task.id_dentista})">Eliminar</button></td>
                    </tr>`;
            });
            
            taskTableHTML += '</table>';
            taskTableDiv.innerHTML = taskTableHTML;
        }
//---------------------------------------------Fin---------------------------//

 //---------------------------------------------Mostrar Delete---------------------------//
        function deleteTask(taskId) {
          var confirmDelete = confirm("¿Estás seguro de que deseas eliminar esta tarea?");
          if (confirmDelete) {
              var xhr = new XMLHttpRequest();
              xhr.onreadystatechange = function() {
                  if (xhr.readyState === 4) {
                      if (xhr.status === 200) {
                          try {
                              var data = JSON.parse(xhr.responseText);
                              console.log('Respuesta del servidor:', data);
                          } catch (error) {
                              console.error("Error al analizar la respuesta JSON:", error);
                          }
                      } else {
                          console.error("Error en la solicitud HTTP:", xhr.status, xhr.statusText);
                      }
                  }
              };
              
              xhr.open('DELETE', `./api/api.php?id=${taskId}`, true);
              xhr.send();
          }
      }
//---------------------------------------------Fin---------------------------//
    </script>
</body>
</html>
